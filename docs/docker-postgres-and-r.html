<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>R, Databases and Docker</title>
  <meta name="description" content="A collection of tutorials for integrating R with databases using Docker">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="R, Databases and Docker" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A collection of tutorials for integrating R with databases using Docker" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="R, Databases and Docker" />
  
  <meta name="twitter:description" content="A collection of tutorials for integrating R with databases using Docker" />
  

<meta name="author" content="Dipti Muni, Ian Frantz, John David Smith, Mary Anne Thygesen, M. Edward (Ed) Borasky, Scott Case, and Sophie Yang">


<meta name="date" content="2018-09-23">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="learning-goals-and-use-cases.html">
<link rel="next" href="a-persistent-database-in-postgres-in-docker-all-at-once.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">R, Databases and Docker</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#using-r-to-query-a-dbms-in-your-organization"><i class="fa fa-check"></i><b>1.1</b> Using R to query a DBMS in your organization</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#dockers-role"><i class="fa fa-check"></i><b>1.2</b> Dockerâ€™s role</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#docker-and-r-on-your-machine"><i class="fa fa-check"></i><b>1.3</b> Docker and R on your machine</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#who-are-we"><i class="fa fa-check"></i><b>1.4</b> Who are we?</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#prerequisites"><i class="fa fa-check"></i><b>1.5</b> Prerequisites</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#install-docker"><i class="fa fa-check"></i><b>1.6</b> Install Docker</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#download-the-repo"><i class="fa fa-check"></i><b>1.7</b> Download the repo</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html"><i class="fa fa-check"></i><b>2</b> Docker Hosting for Windows</a><ul>
<li class="chapter" data-level="2.1" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#hardware-requirements"><i class="fa fa-check"></i><b>2.1</b> Hardware requirements</a></li>
<li class="chapter" data-level="2.2" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#software-requirements"><i class="fa fa-check"></i><b>2.2</b> Software requirements</a><ul>
<li class="chapter" data-level="2.2.1" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#windows-7-8-8.1-and-windows-10-home-64-bit"><i class="fa fa-check"></i><b>2.2.1</b> Windows 7, 8, 8.1 and Windows 10 Home (64 bit)</a></li>
<li class="chapter" data-level="2.2.2" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#windows-10-pro"><i class="fa fa-check"></i><b>2.2.2</b> Windows 10 Pro</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#docker-for-windows-settings"><i class="fa fa-check"></i><b>2.3</b> Docker for Windows settings</a><ul>
<li class="chapter" data-level="2.3.1" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#shared-drives"><i class="fa fa-check"></i><b>2.3.1</b> Shared drives</a></li>
<li class="chapter" data-level="2.3.2" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#kubernetes"><i class="fa fa-check"></i><b>2.3.2</b> Kubernetes</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="docker-hosting-for-windows.html"><a href="docker-hosting-for-windows.html#git-github-and-line-endings"><i class="fa fa-check"></i><b>2.4</b> Git, GitHub and line endings</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="learning-goals-and-use-cases.html"><a href="learning-goals-and-use-cases.html"><i class="fa fa-check"></i><b>3</b> Learning Goals and Use Cases</a><ul>
<li class="chapter" data-level="3.1" data-path="learning-goals-and-use-cases.html"><a href="learning-goals-and-use-cases.html#context-why-integrate-r-with-databases-using-docker"><i class="fa fa-check"></i><b>3.1</b> Context: Why integrate R with databases using Docker?</a></li>
<li class="chapter" data-level="3.2" data-path="learning-goals-and-use-cases.html"><a href="learning-goals-and-use-cases.html#learning-goals"><i class="fa fa-check"></i><b>3.2</b> Learning Goals</a></li>
<li class="chapter" data-level="3.3" data-path="learning-goals-and-use-cases.html"><a href="learning-goals-and-use-cases.html#use-cases"><i class="fa fa-check"></i><b>3.3</b> Use cases</a></li>
<li class="chapter" data-level="3.4" data-path="learning-goals-and-use-cases.html"><a href="learning-goals-and-use-cases.html#environment"><i class="fa fa-check"></i><b>3.4</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html"><i class="fa fa-check"></i><b>4</b> Docker, Postgres, and R</a><ul>
<li class="chapter" data-level="4.1" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#verify-that-docker-running"><i class="fa fa-check"></i><b>4.1</b> Verify that Docker running</a></li>
<li class="chapter" data-level="4.2" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#clean-up-if-appropriate"><i class="fa fa-check"></i><b>4.2</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="4.3" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#put-the-database-password-in-an-environment-file"><i class="fa fa-check"></i><b>4.3</b> Put the database password in an environment file</a></li>
<li class="chapter" data-level="4.4" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#connect-read-and-write-to-postgres-from-r"><i class="fa fa-check"></i><b>4.4</b> Connect, read and write to Postgres from R</a><ul>
<li class="chapter" data-level="4.4.1" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#pause-for-some-security-considerations"><i class="fa fa-check"></i><b>4.4.1</b> Pause for some security considerations</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="docker-postgres-and-r.html"><a href="docker-postgres-and-r.html#clean-up"><i class="fa fa-check"></i><b>4.5</b> Clean up</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html"><i class="fa fa-check"></i><b>5</b> A persistent database in Postgres in Docker - all at once</a><ul>
<li class="chapter" data-level="5.1" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a></li>
<li class="chapter" data-level="5.2" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#first-verify-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>5.2</b> First, verify that Docker is up and running:</a></li>
<li class="chapter" data-level="5.3" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#clean-up-if-appropriate-1"><i class="fa fa-check"></i><b>5.3</b> Clean up if appropriate</a></li>
<li class="chapter" data-level="5.4" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#build-the-docker-image"><i class="fa fa-check"></i><b>5.4</b> Build the Docker Image</a></li>
<li class="chapter" data-level="5.5" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#run-the-docker-image"><i class="fa fa-check"></i><b>5.5</b> Run the Docker Image</a></li>
<li class="chapter" data-level="5.6" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#connect-to-postgres-with-r"><i class="fa fa-check"></i><b>5.6</b> Connect to Postgres with R</a></li>
<li class="chapter" data-level="5.7" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#stop-and-start-to-demonstrate-persistence"><i class="fa fa-check"></i><b>5.7</b> Stop and start to demonstrate persistence</a></li>
<li class="chapter" data-level="5.8" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#cleaning-up"><i class="fa fa-check"></i><b>5.8</b> Cleaning up</a></li>
<li class="chapter" data-level="5.9" data-path="a-persistent-database-in-postgres-in-docker-all-at-once.html"><a href="a-persistent-database-in-postgres-in-docker-all-at-once.html#using-the-sql-pet-container-in-the-rest-of-the-book"><i class="fa fa-check"></i><b>5.9</b> Using the <code>sql-pet</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html"><i class="fa fa-check"></i><b>6</b> A persistent database in Postgres in Docker - piecemeal</a><ul>
<li class="chapter" data-level="6.1" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#overview-1"><i class="fa fa-check"></i><b>6.1</b> Overview</a></li>
<li class="chapter" data-level="6.2" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#retrieve-the-backup-file"><i class="fa fa-check"></i><b>6.2</b> Retrieve the backup file</a></li>
<li class="chapter" data-level="6.3" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#now-verify-that-docker-is-up-and-running"><i class="fa fa-check"></i><b>6.3</b> Now, verify that Docker is up and running:</a></li>
<li class="chapter" data-level="6.4" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#build-the-docker-image-1"><i class="fa fa-check"></i><b>6.4</b> Build the Docker Image</a></li>
<li class="chapter" data-level="6.5" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#stop-and-start-to-demonstrate-persistence-1"><i class="fa fa-check"></i><b>6.5</b> Stop and start to demonstrate persistence</a></li>
<li class="chapter" data-level="6.6" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#cleaning-up-1"><i class="fa fa-check"></i><b>6.6</b> Cleaning up</a></li>
<li class="chapter" data-level="6.7" data-path="a-persistent-database-in-postgres-in-docker-piecemeal.html"><a href="a-persistent-database-in-postgres-in-docker-piecemeal.html#using-the-sql-pet-container-in-the-rest-of-the-book-1"><i class="fa fa-check"></i><b>6.7</b> Using the <code>sql-pet</code> container in the rest of the book</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduction-to-interacting-with-postgres-from-r.html"><a href="introduction-to-interacting-with-postgres-from-r.html"><i class="fa fa-check"></i><b>7</b> Introduction to interacting with Postgres from R</a><ul>
<li class="chapter" data-level="7.1" data-path="introduction-to-interacting-with-postgres-from-r.html"><a href="introduction-to-interacting-with-postgres-from-r.html#basics"><i class="fa fa-check"></i><b>7.1</b> Basics</a></li>
<li class="chapter" data-level="7.2" data-path="introduction-to-interacting-with-postgres-from-r.html"><a href="introduction-to-interacting-with-postgres-from-r.html#ask-yourself-about-what-you-are-aiming-for"><i class="fa fa-check"></i><b>7.2</b> Ask yourself about what you are aiming for?</a></li>
<li class="chapter" data-level="7.3" data-path="introduction-to-interacting-with-postgres-from-r.html"><a href="introduction-to-interacting-with-postgres-from-r.html#get-some-basic-information-about-your-database"><i class="fa fa-check"></i><b>7.3</b> Get some basic information about your database</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html"><i class="fa fa-check"></i><b>8</b> Real work with real data</a><ul>
<li class="chapter" data-level="8.1" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#some-extra-handy-libraries"><i class="fa fa-check"></i><b>8.1</b> Some extra handy libraries</a></li>
<li class="chapter" data-level="8.2" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#basic-investigation"><i class="fa fa-check"></i><b>8.2</b> Basic investigation</a></li>
<li class="chapter" data-level="8.3" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#using-dplyr"><i class="fa fa-check"></i><b>8.3</b> Using Dplyr</a><ul>
<li class="chapter" data-level="8.3.1" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#finding-out-whats-in-the-database"><i class="fa fa-check"></i><b>8.3.1</b> finding out whatâ€™s in the database</a></li>
<li class="chapter" data-level="8.3.2" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#sample-query"><i class="fa fa-check"></i><b>8.3.2</b> sample query</a></li>
<li class="chapter" data-level="8.3.3" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#subset-only-retrieve-what-you-need"><i class="fa fa-check"></i><b>8.3.3</b> Subset: only retrieve what you need</a></li>
<li class="chapter" data-level="8.3.4" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#make-the-server-do-as-much-work-as-you-can"><i class="fa fa-check"></i><b>8.3.4</b> Make the server do as much work as you can</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#what-is-dplyr-sending-to-the-server"><i class="fa fa-check"></i><b>8.4</b> What is dplyr sending to the server?</a></li>
<li class="chapter" data-level="8.5" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#writing-your-on-sql-directly-to-the-dbms"><i class="fa fa-check"></i><b>8.5</b> Writing your on SQL directly to the DBMS</a></li>
<li class="chapter" data-level="8.6" data-path="real-work-with-real-data.html"><a href="real-work-with-real-data.html#chosing-between-dplyr-and-native-sql"><i class="fa fa-check"></i><b>8.6</b> Chosing between dplyr and native SQL</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="real-work-with-real-data-1.html"><a href="real-work-with-real-data-1.html"><i class="fa fa-check"></i><b>9</b> Real work with real data</a><ul>
<li class="chapter" data-level="9.1" data-path="real-work-with-real-data-1.html"><a href="real-work-with-real-data-1.html#some-extra-handy-libraries-1"><i class="fa fa-check"></i><b>9.1</b> Some extra handy libraries</a></li>
<li class="chapter" data-level="9.2" data-path="real-work-with-real-data-1.html"><a href="real-work-with-real-data-1.html#more-topics"><i class="fa fa-check"></i><b>9.2</b> More topics</a></li>
<li class="chapter" data-level="9.3" data-path="real-work-with-real-data-1.html"><a href="real-work-with-real-data-1.html#standards-for-production-jobs"><i class="fa fa-check"></i><b>9.3</b> Standards for production jobs</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="postgres-examples-part-a.html"><a href="postgres-examples-part-a.html"><i class="fa fa-check"></i><b>10</b> Postgres Examples, part A</a><ul>
<li class="chapter" data-level="10.1" data-path="postgres-examples-part-a.html"><a href="postgres-examples-part-a.html#verify-docker-is-up-and-running"><i class="fa fa-check"></i><b>10.1</b> Verify Docker is up and running:</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="postgres-examples-part-b.html"><a href="postgres-examples-part-b.html"><i class="fa fa-check"></i><b>11</b> Postgres Examples, part B</a><ul>
<li class="chapter" data-level="11.1" data-path="postgres-examples-part-b.html"><a href="postgres-examples-part-b.html#verify-docker-is-up-and-running-1"><i class="fa fa-check"></i><b>11.1</b> Verify Docker is up and running:</a></li>
<li class="chapter" data-level="11.2" data-path="postgres-examples-part-b.html"><a href="postgres-examples-part-b.html#sql-execution-steps"><i class="fa fa-check"></i><b>11.2</b> SQL Execution Steps</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="other-resources.html"><a href="other-resources.html"><i class="fa fa-check"></i><b>12</b> Other resources</a><ul>
<li class="chapter" data-level="12.1" data-path="other-resources.html"><a href="other-resources.html#editing-this-book"><i class="fa fa-check"></i><b>12.1</b> Editing this book</a></li>
<li class="chapter" data-level="12.2" data-path="other-resources.html"><a href="other-resources.html#docker-alternatives"><i class="fa fa-check"></i><b>12.2</b> Docker alternatives</a></li>
<li class="chapter" data-level="12.3" data-path="other-resources.html"><a href="other-resources.html#docker-and-r"><i class="fa fa-check"></i><b>12.3</b> Docker and R</a></li>
<li class="chapter" data-level="12.4" data-path="other-resources.html"><a href="other-resources.html#documentation-docker-and-postgres"><i class="fa fa-check"></i><b>12.4</b> Documentation Docker and Postgres</a></li>
<li class="chapter" data-level="12.5" data-path="other-resources.html"><a href="other-resources.html#more-resources"><i class="fa fa-check"></i><b>12.5</b> More Resources</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R, Databases and Docker</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="docker-postgres-and-r" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> Docker, Postgres, and R</h1>
<p>We always load the tidyverse and some other packages, but donâ€™t show it unless we are using packages other than <code>tidyverse</code>, <code>DBI</code>, <code>RPostgres</code>, and <code>glue</code>.</p>
<div id="verify-that-docker-running" class="section level2">
<h2><span class="header-section-number">4.1</span> Verify that Docker running</h2>
<p>Docker commands can be run from a terminal (e.g., the Rstudio Terminal pane) or with a <code>system()</code> command. In this tutorial, we use <code>system2()</code> so that all the output that is created externally is shown. Note that <code>system2</code> calls are divided into several parts:</p>
<ol style="list-style-type: decimal">
<li>The program that you are sending a command to.</li>
<li>The parameters or commands that are being sent</li>
<li><code>stdout = TRUE, stderr = TRUE</code> are two parameters that are standard in this book, so that the comandâ€™s full output is shown in the book.</li>
</ol>
<p>The <code>docker version</code> command returns the details about the docker daemon that is running on your computer.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;version&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>, <span class="dt">stderr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;Client:&quot;                                        
##  [2] &quot; Version:           18.06.1-ce&quot;                 
##  [3] &quot; API version:       1.38&quot;                       
##  [4] &quot; Go version:        go1.10.3&quot;                   
##  [5] &quot; Git commit:        e68fc7a&quot;                    
##  [6] &quot; Built:             Tue Aug 21 17:21:31 2018&quot;   
##  [7] &quot; OS/Arch:           darwin/amd64&quot;               
##  [8] &quot; Experimental:      false&quot;                      
##  [9] &quot;&quot;                                               
## [10] &quot;Server:&quot;                                        
## [11] &quot; Engine:&quot;                                       
## [12] &quot;  Version:          18.06.1-ce&quot;                 
## [13] &quot;  API version:      1.38 (minimum version 1.12)&quot;
## [14] &quot;  Go version:       go1.10.3&quot;                   
## [15] &quot;  Git commit:       e68fc7a&quot;                    
## [16] &quot;  Built:            Tue Aug 21 17:29:02 2018&quot;   
## [17] &quot;  OS/Arch:          linux/amd64&quot;                
## [18] &quot;  Experimental:     true&quot;</code></pre>
</div>
<div id="clean-up-if-appropriate" class="section level2">
<h2><span class="header-section-number">4.2</span> Clean up if appropriate</h2>
<p>Remove the <code>cattle</code> and <code>sql-pet</code> containers if they exists (e.g., from a prior experiments).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="cf">if</span> (<span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;ps -a&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="st">   </span><span class="kw">grepl</span>(<span class="dt">x =</span> ., <span class="dt">pattern =</span> <span class="st">&#39;cattle&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">   </span><span class="kw">any</span>()) {</a>
<a class="sourceLine" id="cb3-4" data-line-number="4">     <span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;rm -f cattle&quot;</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="cf">if</span> (<span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;ps -a&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">   </span><span class="kw">grepl</span>(<span class="dt">x =</span> ., <span class="dt">pattern =</span> <span class="st">&#39;sql-pet&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="st">   </span><span class="kw">any</span>()) {</a>
<a class="sourceLine" id="cb3-9" data-line-number="9">     <span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;rm -f sql-pet&quot;</span>)</a>
<a class="sourceLine" id="cb3-10" data-line-number="10">}</a></code></pre></div>
<p>The convention we use in this book is to assemble a command with <code>glue</code> so that the you can see all of its separate parts. The following chunk just constructs the command, but does not execute it. If you have problems executing a commnad, you can always copy the command and execute in your terminal session.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">docker_cmd &lt;-<span class="st"> </span><span class="kw">glue</span>(</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">  <span class="st">&quot;run &quot;</span>,      <span class="co"># Run is the Docker command.  Everything that follows are `docker run` parameters.</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  <span class="st">&quot;--detach &quot;</span>, <span class="co"># (or `-d`) tells Docker to disconnect from the terminal / program issuing the command</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="st">&quot;--name cattle &quot;</span>,       <span class="co"># tells Docker to give the container a name: `cattle`</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">  <span class="st">&quot;--publish 5432:5432 &quot;</span>, <span class="co"># tells Docker to expose the Postgres port 5432 to the local network with 5432</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6">  <span class="st">&quot; postgres:10&quot;</span>  <span class="co"># tells Docker the image that is to be run (after downloading if necessary)</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"></a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="co"># We name containers `cattle` for &quot;throw-aways&quot; and `pet` for ones we treasure and keep around.  :-)</span></a></code></pre></div>
<p>Submit the command constructed above:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># this is what you would submit from a terminal:</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">cat</span>(<span class="kw">glue</span>(<span class="st">&quot; docker &quot;</span>, docker_cmd))</a></code></pre></div>
<pre><code>##  docker run --detach --name cattle --publish 5432:5432  postgres:10</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># this is how R submits it to Docker:</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, docker_cmd, <span class="dt">stdout =</span> <span class="ot">TRUE</span>, <span class="dt">stderr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;1cb6ed3e321000e2b5133580e0405c06812603fe830068ac865e9343849cb611&quot;</code></pre>
<p>Docker returns a long string of numbers. If you are running this command for the first time, Docker is downloading the Postgres image and it takes a bit of time.</p>
<p>The following comand shows that <code>postgres:10</code> is running. <code>postgres</code> is waiting for a connection:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;ps&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>, <span class="dt">stderr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                  PORTS                    NAMES&quot;   
## [2] &quot;1cb6ed3e3210        postgres:10         \&quot;docker-entrypoint.sâ€¦\&quot;   1 second ago        Up Less than a second   0.0.0.0:5432-&gt;5432/tcp   cattle&quot;</code></pre>
</div>
<div id="put-the-database-password-in-an-environment-file" class="section level2">
<h2><span class="header-section-number">4.3</span> Put the database password in an environment file</h2>
<p>The goal is to put the password in an untracked file that will <strong>not</strong> be committed in your source code repository. Your code can reference the name of the variable, but the value of that variable will not appear in open text in your source code.</p>
<p>We have chosen to call the file <code>dev_environment.csv</code> in the current working directory where you are executing this script. That file name appears in the <code>.gitignore</code> file, so that you will not accidentally commit it. We are going to create that file now.</p>
<p>You will be prompted for the database password. By default, a postgres database defines a database user named <code>postgres</code>, whose password is <code>postgres</code>. If you have changed the password or created a new user with a different password, then enter those new values when prompted. Otherwise, enter <code>postgres</code> and <code>postgres</code> at the two prompts.</p>
<p>In an interactive environment, you could execute a snippet of code that prompts the user for their username and password with the followoing snippet (which isnâ€™t run in the book):</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">prompt_for_postgres &lt;-<span class="st"> </span><span class="cf">function</span>(seconds_to_test){</a>
<a class="sourceLine" id="cb11-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>seconds_to_test) {</a>
<a class="sourceLine" id="cb11-3" data-line-number="3">    db_ready &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbCanConnect</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb11-4" data-line-number="4">                                  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb11-5" data-line-number="5">                                  <span class="dt">port =</span> <span class="st">&quot;5432&quot;</span>,</a>
<a class="sourceLine" id="cb11-6" data-line-number="6">                                  <span class="dt">user =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(environment_variables, variable <span class="op">==</span><span class="st"> &quot;username&quot;</span>)[, <span class="st">&quot;value&quot;</span>],</a>
<a class="sourceLine" id="cb11-7" data-line-number="7">                                  <span class="dt">password =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(environment_variables, variable <span class="op">==</span><span class="st"> &quot;password&quot;</span>)[, <span class="st">&quot;value&quot;</span>],</a>
<a class="sourceLine" id="cb11-8" data-line-number="8">                                  <span class="dt">dbname =</span> <span class="st">&quot;postgres&quot;</span>)</a>
<a class="sourceLine" id="cb11-9" data-line-number="9">    <span class="cf">if</span> ( <span class="op">!</span>db_ready ) {<span class="kw">Sys.sleep</span>(<span class="dv">1</span>)}</a>
<a class="sourceLine" id="cb11-10" data-line-number="10">    <span class="cf">else</span> {con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb11-11" data-line-number="11">                                <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb11-12" data-line-number="12">                                <span class="dt">port =</span> <span class="st">&quot;5432&quot;</span>,</a>
<a class="sourceLine" id="cb11-13" data-line-number="13">                                <span class="dt">user =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(environment_variables, variable <span class="op">==</span><span class="st"> &quot;username&quot;</span>)[, <span class="st">&quot;value&quot;</span>],</a>
<a class="sourceLine" id="cb11-14" data-line-number="14">                                <span class="dt">password =</span> dplyr<span class="op">::</span><span class="kw">filter</span>(environment_variables, variable <span class="op">==</span><span class="st"> &quot;password&quot;</span>)[, <span class="st">&quot;value&quot;</span>],</a>
<a class="sourceLine" id="cb11-15" data-line-number="15">                                <span class="dt">dbname =</span> <span class="st">&quot;postgres&quot;</span>)</a>
<a class="sourceLine" id="cb11-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb11-17" data-line-number="17">    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span>seconds_to_test <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>db_ready) {con &lt;-<span class="st"> &quot;there is no connection &quot;</span>}</a>
<a class="sourceLine" id="cb11-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb11-19" data-line-number="19">  con</a>
<a class="sourceLine" id="cb11-20" data-line-number="20">}</a>
<a class="sourceLine" id="cb11-21" data-line-number="21"></a>
<a class="sourceLine" id="cb11-22" data-line-number="22">DB_USERNAME &lt;-<span class="st"> </span><span class="kw">trimws</span>(<span class="kw">readline</span>(<span class="dt">prompt =</span> <span class="st">&quot;username: &quot;</span>), <span class="dt">which =</span> <span class="st">&quot;both&quot;</span>)</a>
<a class="sourceLine" id="cb11-23" data-line-number="23">DB_PASSWORD &lt;-<span class="st"> </span>getPass<span class="op">::</span><span class="kw">getPass</span>(<span class="dt">msg =</span> <span class="st">&quot;password: &quot;</span>)</a>
<a class="sourceLine" id="cb11-24" data-line-number="24">environment_variables =<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb11-25" data-line-number="25">  <span class="dt">variable =</span> <span class="kw">c</span>(<span class="st">&quot;username&quot;</span>, <span class="st">&quot;password&quot;</span>),</a>
<a class="sourceLine" id="cb11-26" data-line-number="26">  <span class="dt">value =</span> <span class="kw">c</span>(DB_USERNAME, DB_PASSWORD),</a>
<a class="sourceLine" id="cb11-27" data-line-number="27">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb11-28" data-line-number="28"><span class="kw">write.csv</span>(environment_variables, <span class="st">&quot;./dev_environment.csv&quot;</span>, <span class="dt">row.names =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Your password is still in plain text in the file, <code>dev_environment.csv</code>, so you should protect that file from exposure. However, you do not need to worry about committing that file accidentally to your git repository, because the name of the file appears in the <code>.gitignore</code> file.</p>
</div>
<div id="connect-read-and-write-to-postgres-from-r" class="section level2">
<h2><span class="header-section-number">4.4</span> Connect, read and write to Postgres from R</h2>
<div id="pause-for-some-security-considerations" class="section level3">
<h3><span class="header-section-number">4.4.1</span> Pause for some security considerations</h3>
<p>Create a connection to Postgres after waiting 3 seconds so that Docker has time to do its thing. For security, we use values from the <code>environment_variables</code> data.frame, rather than keeping the <code>username</code> and <code>password</code> in plain text in this source file.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">wait_for_postgres &lt;-<span class="st"> </span><span class="cf">function</span>(user, password, dbname, <span class="dt">seconds_to_test =</span> <span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span>seconds_to_test) {</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">    db_ready &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbCanConnect</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">                                  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb12-5" data-line-number="5">                                  <span class="dt">port =</span> <span class="st">&quot;5432&quot;</span>,</a>
<a class="sourceLine" id="cb12-6" data-line-number="6">                                  <span class="dt">user =</span> user,</a>
<a class="sourceLine" id="cb12-7" data-line-number="7">                                  <span class="dt">password =</span> password,</a>
<a class="sourceLine" id="cb12-8" data-line-number="8">                                  <span class="dt">dbname =</span> dbname)</a>
<a class="sourceLine" id="cb12-9" data-line-number="9">    <span class="cf">if</span> ( <span class="op">!</span>db_ready ) {<span class="kw">Sys.sleep</span>(<span class="dv">1</span>)}</a>
<a class="sourceLine" id="cb12-10" data-line-number="10">    <span class="cf">else</span> {con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb12-11" data-line-number="11">                                <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb12-12" data-line-number="12">                                <span class="dt">port =</span> <span class="st">&quot;5432&quot;</span>,</a>
<a class="sourceLine" id="cb12-13" data-line-number="13">                                <span class="dt">user =</span> user,</a>
<a class="sourceLine" id="cb12-14" data-line-number="14">                                <span class="dt">password =</span> password,</a>
<a class="sourceLine" id="cb12-15" data-line-number="15">                                <span class="dt">dbname =</span> dbname)</a>
<a class="sourceLine" id="cb12-16" data-line-number="16">    }</a>
<a class="sourceLine" id="cb12-17" data-line-number="17">    <span class="cf">if</span> (i <span class="op">==</span><span class="st"> </span>seconds_to_test <span class="op">&amp;</span><span class="st"> </span><span class="op">!</span>db_ready) {con &lt;-<span class="st"> &quot;There is no connection&quot;</span>}</a>
<a class="sourceLine" id="cb12-18" data-line-number="18">  }</a>
<a class="sourceLine" id="cb12-19" data-line-number="19">  con</a>
<a class="sourceLine" id="cb12-20" data-line-number="20">}</a></code></pre></div>
<p>This <code>wait_for_postgres</code> function uses environment variables that R obtains from reading a file named <code>.Rprofile</code> which is found in your default directory. To see whether you have already created that file, execute:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">dir</span>(<span class="dt">path =</span> <span class="st">&quot;~&quot;</span>, <span class="dt">pattern =</span> <span class="st">&quot;.Rprofile&quot;</span>, <span class="dt">all.files =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;.Rprofile&quot;</code></pre>
<p>It should contain lines such as:</p>
<pre><code>  DEFAULT_POSTGRES_PASSWORD=postgres
  DEFAULT_POSTGRES_USER_NAME=postgres</code></pre>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">con &lt;-<span class="st"> </span><span class="kw">wait_for_postgres</span>(<span class="dt">user =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_USER_NAME&quot;</span>),</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">                         <span class="dt">password =</span> <span class="kw">Sys.getenv</span>(<span class="st">&quot;DEFAULT_POSTGRES_PASSWORD&quot;</span>),</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">                         <span class="dt">dbname =</span> <span class="st">&quot;postgres&quot;</span>,</a>
<a class="sourceLine" id="cb16-4" data-line-number="4">                         <span class="dt">seconds_to_test =</span> <span class="dv">10</span>)</a></code></pre></div>
<p>Show that you can connect but that Postgres database doesnâ€™t contain any tables:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1"><span class="kw">dbListTables</span>(con)</a></code></pre></div>
<pre><code>## character(0)</code></pre>
<p>Write <code>mtcars</code> to Postgres</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">dbWriteTable</span>(con, <span class="st">&quot;mtcars&quot;</span>, mtcars)</a></code></pre></div>
<p>List the tables in the Postgres database to show that <code>mtcars</code> is now there:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">dbListTables</span>(con)</a></code></pre></div>
<pre><code>## [1] &quot;mtcars&quot;</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="co"># list the fields in mtcars:</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="kw">dbListFields</span>(con, <span class="st">&quot;mtcars&quot;</span>)</a></code></pre></div>
<pre><code>##  [1] &quot;mpg&quot;  &quot;cyl&quot;  &quot;disp&quot; &quot;hp&quot;   &quot;drat&quot; &quot;wt&quot;   &quot;qsec&quot; &quot;vs&quot;   &quot;am&quot;   &quot;gear&quot;
## [11] &quot;carb&quot;</code></pre>
<p>Download the table from the DBMS to a local data frame:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">mtcars_df &lt;-<span class="st"> </span><span class="kw">tbl</span>(con, <span class="st">&quot;mtcars&quot;</span>)</a>
<a class="sourceLine" id="cb24-2" data-line-number="2"></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="co"># Show a few rows:</span></a>
<a class="sourceLine" id="cb24-4" data-line-number="4">knitr<span class="op">::</span><span class="kw">kable</span>(<span class="kw">head</span>(mtcars_df))</a></code></pre></div>
<table>
<thead>
<tr class="header">
<th align="right">mpg</th>
<th align="right">cyl</th>
<th align="right">disp</th>
<th align="right">hp</th>
<th align="right">drat</th>
<th align="right">wt</th>
<th align="right">qsec</th>
<th align="right">vs</th>
<th align="right">am</th>
<th align="right">gear</th>
<th align="right">carb</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.620</td>
<td align="right">16.46</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="right">21.0</td>
<td align="right">6</td>
<td align="right">160</td>
<td align="right">110</td>
<td align="right">3.90</td>
<td align="right">2.875</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">4</td>
</tr>
<tr class="odd">
<td align="right">22.8</td>
<td align="right">4</td>
<td align="right">108</td>
<td align="right">93</td>
<td align="right">3.85</td>
<td align="right">2.320</td>
<td align="right">18.61</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">21.4</td>
<td align="right">6</td>
<td align="right">258</td>
<td align="right">110</td>
<td align="right">3.08</td>
<td align="right">3.215</td>
<td align="right">19.44</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">18.7</td>
<td align="right">8</td>
<td align="right">360</td>
<td align="right">175</td>
<td align="right">3.15</td>
<td align="right">3.440</td>
<td align="right">17.02</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">18.1</td>
<td align="right">6</td>
<td align="right">225</td>
<td align="right">105</td>
<td align="right">2.76</td>
<td align="right">3.460</td>
<td align="right">20.22</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="clean-up" class="section level2">
<h2><span class="header-section-number">4.5</span> Clean up</h2>
<p>Afterwards, always disconnect from the DBMS, stop the docker container and (optionally) remove it.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" data-line-number="1"><span class="kw">dbDisconnect</span>(con)</a>
<a class="sourceLine" id="cb25-2" data-line-number="2"></a>
<a class="sourceLine" id="cb25-3" data-line-number="3"><span class="co"># tell Docker to stop the container:</span></a>
<a class="sourceLine" id="cb25-4" data-line-number="4"><span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;stop cattle&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>, <span class="dt">stderr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cattle&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb27-1" data-line-number="1"><span class="co"># tell Docker to remove the container from it&#39;s library of active containers:</span></a>
<a class="sourceLine" id="cb27-2" data-line-number="2"><span class="kw">system2</span>(<span class="st">&quot;docker&quot;</span>, <span class="st">&quot;rm cattle&quot;</span>, <span class="dt">stdout =</span> <span class="ot">TRUE</span>, <span class="dt">stderr =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<pre><code>## [1] &quot;cattle&quot;</code></pre>
<p>If we <code>stop</code> the docker container but donâ€™t remove it (with the <code>rm cattle</code> command), the container will persist and we can start it up again later with <code>start cattle</code>. In that case, <code>mtcars</code> would still be there and we could retrieve it from R again. Since we have now removed the <code>cattle</code> container, the whole database has been deleted. (There are enough copies of <code>mtcars</code> in the world, so no great loss.)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="learning-goals-and-use-cases.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="a-persistent-database-in-postgres-in-docker-all-at-once.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/smithjd/sql-pet/edit/master/r-database-docker/04-docker-setup-postgres-connect-with-r.Rmd",
"text": "Edit"
},
"download": ["r-database-docker.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
